$(function(){
  
  $('body').fadeOut("slow", function(){
    $('body').html('<%= escape_javascript render(partial: "step1") %>').hide().fadeIn("slow");

    var userPhoneNumber = $('#phone_number').text();
    
    var faye = new Faye.Client('http://localhost:9292/getting-started/faye');
    var step = 1;
    faye.subscribe('/getting-started/feed', function (data) {
      
      var obj = eval("(" + data + ")");
      var phoneNumber = obj.phone_number;
      var textBody = obj.body;

      if (phoneNumber === userPhoneNumber) {
        if (step === 1 && textBody === '@groceries') {
          $('body').fadeOut("slow", function(){
            $('body').html('<%= escape_javascript render(partial: "step2") %>').hide().fadeIn("slow");
            step = step+1;   
          });
        } else if (step === 2 && textBody === 'groceries+bananas, grapes, cereal') {
          $('body').fadeOut("slow", function(){
            $('body').html('<%= escape_javascript render(partial: "step3") %>').hide().fadeIn("slow");
            step = step+1;   
          });
        } else if (step === 3 && textBody === 'groceries-bananas') {
          $('body').fadeOut("slow", function(){
            $('body').html('<%= escape_javascript render(partial: "step4") %>').hide().fadeIn("slow");
            step = step+1;   
          });
        } else if (step === 4 && textBody === '#groceries') {
          $('body').fadeOut("slow", function(){
            $('body').html('<%= escape_javascript render(partial: "step5") %>').hide().fadeIn("slow");
            step = step+1;   
          });
        } else if (step === 5 && textBody === '@todo+walk the dog') {
          $('body').fadeOut("slow", function(){
            $('body').html('<%= escape_javascript render(partial: "step6") %>').hide().fadeIn("slow");
            step = step+1;   
          });
        } else if (step === 6 && textBody === '*') {
          $('body').fadeOut("slow", function(){
            $('body').html('<%= escape_javascript render(partial: "step7") %>').hide().fadeIn("slow");
            step = step+1;   
          });
        } else if (step === 7 && textBody === '!groceries') {
          $('body').fadeOut("slow", function(){
            $('body').html('<%= escape_javascript render(partial: "step8") %>').hide().fadeIn("slow");
            step = step+1;   
          });
        } else if (step === 8 && textBody === '?') {
          $('body').fadeOut("slow", function(){
            $('body').html('<%= escape_javascript render(partial: "step9") %>').hide().fadeIn("slow");
            step = step+1;   
          });
        };
      };

    });
  });

})